{# templates/CENRO/CENRO_dashboard.html #} {% extends "base.html" %} {% load
static %} {% block title %}CENRO Dashboard{% endblock %} {% block extra_css %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
  .content-surface {
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
  }
  .stat-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
  }
  .stat-grid .card {
    background: #fff;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    text-align: center;
    transition: transform 0.2s ease;
  }
  .stat-grid .card:hover {
    transform: translateY(-3px);
  }
  .stat-grid h2 {
    color: #007bff;
    font-size: 16px;
    margin-bottom: 5px;
  }
  .stat-grid p {
    font-size: 24px;
    font-weight: bold;
  }

  .charts-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 25px;
  }
  .chart-container {
    background: #fff;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  }
  .chart-container h3 {
    font-size: 16px;
    margin-bottom: 10px;
    color: #004c3f;
  }
</style>
{% endblock %} {% block content %}
<div class="content-surface">
  <!-- Cards -->
  <div class="stat-grid">
    <div class="card">
      <h2>APPROVED</h2>
      <p>{{ stats.approved_users|default:0 }}</p>
    </div>
    <div class="card">
      <h2>REJECTED</h2>
      <p>{{ stats.rejected_users|default:0 }}</p>
    </div>
    <div class="card">
      <h2>PENDING</h2>
      <p>{{ stats.pending_users|default:0 }}</p>
    </div>
  </div>

  <!-- Charts Row -->
  <div class="charts-row">
    <div class="chart-container">
      <h3>Report Status Overview</h3>
      <canvas
        id="reportStatusChart"
        data-pending="{{ stats.pending_reports|default:0 }}"
        data-accepted="{{ stats.accepted_reports|default:0 }}"
        data-declined="{{ stats.declined_reports|default:0 }}"
      >
      </canvas>
    </div>

    <div class="chart-container">
      <h3>Reports per Protected Area</h3>
      {% if reports_per_pa.labels %}
      <canvas
        id="reportsPerPAChart"
        data-labels="{{ reports_per_pa.labels|join:',' }}"
        data-counts="{{ reports_per_pa.counts|join:',' }}"
      >
      </canvas>
      {% else %}
      <div style="text-align: center; padding: 50px; color: #6c757d">
        No reports data available to display the chart.
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    // === Report Status Chart ===
    const statusChartEl = document.getElementById("reportStatusChart");
    if (statusChartEl) {
      const pending = parseInt(statusChartEl.dataset.pending || 0);
      const accepted = parseInt(statusChartEl.dataset.accepted || 0);
      const declined = parseInt(statusChartEl.dataset.declined || 0);

      new Chart(statusChartEl, {
        type: "doughnut",
        data: {
          labels: ["Pending", "Accepted", "Declined"],
          datasets: [
            {
              data: [pending, accepted, declined],
              backgroundColor: ["#ffc107", "#28a745", "#dc3545"],
            },
          ],
        },
        options: {
          responsive: true,
          plugins: { legend: { position: "bottom" } },
        },
      });
    }

    // === Reports per Protected Area Chart ===
    const paChartEl = document.getElementById("reportsPerPAChart");
    if (paChartEl) {
      const labels = paChartEl.dataset.labels.split(",");
      const counts = paChartEl.dataset.counts.split(",").map(Number);

      new Chart(paChartEl, {
        type: "bar",
        data: {
          labels,
          datasets: [
            {
              label: "Reports",
              data: counts,
              backgroundColor: "#007bff",
            },
          ],
        },
        options: {
          responsive: true,
          scales: {
            x: { title: { display: true, text: "Protected Areas" } },
            y: { beginAtZero: true, title: { display: true, text: "Reports" } },
          },
          plugins: { legend: { display: false } },
        },
      });
    }
  });
</script>
{% endblock %}
